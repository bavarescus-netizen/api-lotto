<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto AI V4 - QUANTUM PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; background: #020617; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .neon-border-blue { border-left: 4px solid #3b82f6; box-shadow: -10px 0 20px -10px rgba(59, 130, 246, 0.5); }
        .neon-border-green { border-left: 4px solid #10b981; box-shadow: -10px 0 20px -10px rgba(16, 185, 129, 0.5); }
        
        .pulse-ring { animation: ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes ring { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
        
        .gradient-text { background: linear-gradient(90deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        canvas { filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.2)); }
    </style>
</head>
<body class="text-slate-200 pb-28">

    <header class="p-4 glass sticky top-0 z-50 flex justify-between items-center border-b border-slate-800">
        <div class="flex items-center gap-3">
            <div class="relative">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <div class="absolute inset-0 w-3 h-3 bg-blue-500 rounded-full animate-ping"></div>
            </div>
            <div>
                <h1 class="text-xs font-black tracking-[0.2em] text-blue-400 uppercase">Neural Engine V4</h1>
                <p class="text-[9px] text-slate-500 font-mono uppercase">Status: Live 2018-2026</p>
            </div>
        </div>
        <div id="reloj" class="mono text-xs font-bold text-blue-400 bg-blue-950/30 px-3 py-1 rounded-full border border-blue-500/30">--:--:--</div>
    </header>

    <main class="p-4 max-w-lg mx-auto space-y-6">
        
        <section id="page-home" class="page-content space-y-6">
            <div id="status-card" class="glass p-6 rounded-[2rem] neon-border-blue relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4">
                    <i class="fas fa-microchip text-slate-800 text-4xl"></i>
                </div>
                
                <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Análisis de Probabilidad</span>
                <div id="dec-text" class="text-4xl font-black my-2 gradient-text">SISTEMA LISTO</div>
                
                <div id="top3-lista" class="space-y-3 mt-6">
                    <div class="text-slate-500 text-xs italic opacity-50 text-center py-4">Presiona el botón para escanear patrones históricos...</div>
                </div>

                <button onclick="ejecutarPrediccion()" class="mt-8 w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-5 rounded-2xl transition-all active:scale-95 shadow-lg shadow-blue-600/20 pulse-ring">
                    <i class="fas fa-radar mr-2"></i> ESCANEAR PRÓXIMA HORA
                </button>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="glass p-4 rounded-2xl border border-slate-800">
                    <p class="text-[9px] text-slate-500 uppercase font-bold">Efectividad Global</p>
                    <p class="text-xl font-black text-green-400">45.2%</p>
                </div>
                <div class="glass p-4 rounded-2xl border border-slate-800">
                    <p class="text-[9px] text-slate-500 uppercase font-bold">Confianza de IA</p>
                    <p id="confianza-val" class="text-xl font-black text-blue-400">OPTIMAL</p>
                </div>
            </div>
        </section>

        <section id="page-stats" class="page-content hidden space-y-6">
            <div class="glass p-6 rounded-[2rem] space-y-6">
                <div class="flex justify-between items-end">
                    <h2 class="text-lg font-black text-white uppercase italic">Métricas de Verdad</h2>
                    <span class="text-[10px] text-blue-400 font-mono">Real-Time Data</span>
                </div>
                
                <div class="space-y-6">
                    <div class="p-4 bg-black/30 rounded-2xl border border-slate-800">
                        <h3 class="text-[10px] text-slate-500 font-bold uppercase mb-4 flex items-center gap-2">
                            <i class="fas fa-chart-line text-blue-500"></i> Eficiencia por Horario (%)
                        </h3>
                        <canvas id="chartHoras"></canvas>
                    </div>
                    
                    <div class="p-4 bg-black/30 rounded-2xl border border-slate-800">
                        <h3 class="text-[10px] text-slate-500 font-bold uppercase mb-4 flex items-center gap-2">
                            <i class="fas fa-trophy text-yellow-500"></i> Animales con Mayor Acierto
                        </h3>
                        <canvas id="chartDias"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-train" class="page-content hidden">
            <div class="glass p-6 rounded-[2rem] space-y-4">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-brain text-blue-400"></i>
                    <h2 class="text-lg font-black uppercase">Deep Learning V4</h2>
                </div>
                <div id="train-log" class="bg-black/80 p-4 rounded-2xl mono text-[10px] text-blue-300 h-80 overflow-y-auto border border-blue-900/30">
                    <span class="text-slate-600">> Inicializando consola...</span><br>
                    <span class="text-slate-600">> Cargando histórico 2018-2026...</span>
                </div>
                <button onclick="iniciarEntrenamiento()" id="btn-train" class="w-full bg-slate-800 hover:bg-slate-700 p-5 rounded-2xl font-black border border-slate-600 transition-all text-sm tracking-widest">
                    RE-CALIBRAR CEREBRO
                </button>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-6 left-4 right-4 glass rounded-3xl p-2 flex justify-around items-center z-50 shadow-2xl border border-white/10">
        <button onclick="showPage('home')" class="nav-btn w-16 h-12 rounded-2xl text-blue-500 bg-blue-500/10 flex flex-col items-center justify-center transition-all">
            <i class="fas fa-crosshairs text-lg"></i>
            <span class="text-[8px] mt-1 font-bold uppercase">Radar</span>
        </button>
        <button onclick="showPage('stats')" class="nav-btn w-16 h-12 rounded-2xl text-slate-500 flex flex-col items-center justify-center transition-all">
            <i class="fas fa-chart-bar text-lg"></i>
            <span class="text-[8px] mt-1 font-bold uppercase">Data</span>
        </button>
        <button onclick="showPage('train')" class="nav-btn w-16 h-12 rounded-2xl text-slate-500 flex flex-col items-center justify-center transition-all">
            <i class="fas fa-terminal text-lg"></i>
            <span class="text-[8px] mt-1 font-bold uppercase">Motor</span>
        </button>
    </nav>

    <script>
        // RELOJ
        setInterval(() => {
            const now = new Date();
            document.getElementById('reloj').innerText = now.toLocaleTimeString([], {hour12: false});
        }, 1000);

        // NAVEGACIÓN PRO
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden', 'scale-95', 'opacity-0'));
            const activePage = document.getElementById('page-' + pageId);
            activePage.classList.remove('hidden');
            setTimeout(() => activePage.classList.remove('scale-95', 'opacity-0'), 50);

            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('text-blue-500', 'bg-blue-500/10');
                b.classList.add('text-slate-500');
            });
            event.currentTarget.classList.add('text-blue-500', 'bg-blue-500/10');
            event.currentTarget.classList.remove('text-slate-500');

            if(pageId === 'stats') cargarEstadisticas();
        }

        // PREDICCIÓN CON SEMÁFORO
        async function ejecutarPrediccion() {
            const decText = document.getElementById('dec-text');
            const lista = document.getElementById('top3-lista');
            decText.innerHTML = '<span class="animate-pulse">PROCESANDO...</span>';
            
            try {
                const res = await fetch('/prediccion/generar');
                const data = await res.json();
                
                decText.innerText = data.decision;
                // Cambiar color según decisión
                decText.className = data.decision.includes("OBSERVAR") ? "text-4xl font-black my-2 text-yellow-500" : "text-4xl font-black my-2 gradient-text";
                
                let html = '';
                data.top3.forEach((item, i) => {
                    const delay = i * 100;
                    html += `
                    <div class="flex items-center justify-between p-4 glass rounded-2xl border-l-4 ${i === 0 ? 'border-blue-500' : 'border-slate-700'} animate-fadeIn">
                        <div class="flex items-center gap-4">
                            <div class="bg-black/50 p-2 rounded-xl border border-slate-800">
                                <img src="/static/${item.imagen}" class="w-10 h-10 object-contain" onerror="this.src='https://via.placeholder.com/50?text=?'">
                            </div>
                            <div>
                                <div class="text-[10px] text-slate-500 font-mono font-bold">ID: ${item.numero}</div>
                                <div class="font-black text-white uppercase tracking-tight">${item.animal}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-[9px] text-slate-500 font-bold uppercase">Prob.</div>
                            <div class="text-blue-400 font-black text-lg">${item.porcentaje}</div>
                        </div>
                    </div>`;
                });
                lista.innerHTML = html;
                document.getElementById('confianza-val').innerText = data.decision.includes("ALTA") ? "OPTIMAL" : "STABLE";
            } catch(e) {
                decText.innerText = "OFFLINE";
                lista.innerHTML = `<div class="p-4 bg-red-900/20 rounded-xl text-red-500 text-[10px] mono border border-red-500/30">> ERROR: Link de datos interrumpido.</div>`;
            }
        }

        // CEREBRO DE CALIBRACIÓN
        async function iniciarEntrenamiento() {
            const log = document.getElementById('train-log');
            const btn = document.getElementById('btn-train');
            btn.disabled = true;
            btn.innerText = "PROCESANDO...";
            
            log.innerHTML += `<br><span class="text-white">> Iniciando calibración cruzada...</span>`;
            
            try {
                const res = await fetch('/entrenar/procesar');
                const data = await res.json();
                log.innerHTML += `<br>> Sincronización: <span class="text-green-400">EXITOSA</span>`;
                log.innerHTML += `<br>> Memoria: ${data.calibracion.mensaje}`;
                log.innerHTML += `<br>> Sistema: ${data.entrenamiento.mensaje}`;
                log.innerHTML += `<br><span class="text-blue-400">> IA actualizada con datos 2018-2026.</span>`;
            } catch(e) {
                log.innerHTML += `<br><span class="text-red-500">> CRITICAL ERROR: Falla de red.</span>`;
            } finally {
                btn.disabled = false;
                btn.innerText = "RE-CALIBRAR CEREBRO";
                log.scrollTop = log.scrollHeight;
            }
        }

        // GRÁFICOS REALES
        let chart1, chart2;
        async function cargarEstadisticas() {
            try {
                const res = await fetch('/stats/precision');
                const data = await res.json();
                
                const ctx1 = document.getElementById('chartDias').getContext('2d');
                if(chart1) chart1.destroy();
                chart1 = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data.grafico_barras),
                        datasets: [{
                            data: Object.values(data.grafico_barras),
                            backgroundColor: '#3b82f6',
                            borderRadius: 8
                        }]
                    },
                    options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#1e293b' }, ticks: { color: '#64748b', font: { size: 9 } } }, x: { ticks: { color: '#64748b', font: { size: 9 } } } } }
                });

                const ctx2 = document.getElementById('chartHoras').getContext('2d');
                if(chart2) chart2.destroy();
                chart2 = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: Object.keys(data.grafico_linea),
                        datasets: [{
                            data: Object.values(data.grafico_linea),
                            borderColor: '#10b981',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            pointRadius: 0
                        }]
                    },
                    options: { plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b', font: { size: 8 } } }, x: { ticks: { color: '#64748b', font: { size: 8 } } } } }
                });
            } catch(e) { console.error("Error en stats", e); }
        }
    </script>
</body>
</html>
