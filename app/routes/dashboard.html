<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto AI V4 - PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .lotto-red { background-color: #e11d48; }
        .lotto-black { background-color: #0f172a; }
        .lotto-green { background-color: #16a34a; }
        .page-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        canvas { max-height: 250px; }
    </style>
</head>
<body class="bg-slate-950 text-white pb-24 font-sans">

    <header class="p-4 bg-slate-900 border-b border-slate-800 sticky top-0 z-50 flex justify-between items-center shadow-xl">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
            <h1 class="text-xl font-black text-blue-400 uppercase tracking-tighter">MOTOR V4 ADAPTATIVO</h1>
        </div>
        <div id="reloj" class="text-xs font-mono text-slate-400 bg-black/50 px-2 py-1 rounded">--:--:--</div>
    </header>

    <main class="p-4 max-w-md mx-auto">
        
        <section id="page-home" class="page-content">
            <div id="status-card" class="bg-slate-900 p-6 rounded-3xl border-l-4 border-blue-500 mb-6 text-center shadow-2xl transition-all">
                <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Estado del Mercado</span>
                <div id="dec-text" class="text-3xl font-black py-2 tracking-tight text-white">ANALIZANDO...</div>
                <div id="top3-lista" class="space-y-3 mt-4 text-left"></div>
                <button onclick="ejecutarPrediccion()" class="mt-8 w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-2xl transition-all active:scale-95 shadow-lg shadow-blue-900/40">
                    <i class="fas fa-bolt mr-2"></i> PREDECIR AHORA
                </button>
            </div>
        </section>

        <section id="page-historico" class="page-content hidden">
            <h2 class="text-lg font-bold text-blue-400 uppercase italic mb-4">Historial Reciente</h2>
            <div id="lista-historial" class="space-y-2 overflow-y-auto max-h-[70vh]"></div>
        </section>

        <section id="page-stats" class="page-content hidden">
            <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-2xl space-y-6">
                <h2 class="text-lg font-bold text-blue-400 uppercase"><i class="fas fa-chart-pie mr-2"></i> Inteligencia 2019-2026</h2>
                
                <div class="p-4 bg-black/40 rounded-2xl border border-slate-800">
                    <h3 class="text-[10px] text-slate-500 font-bold uppercase mb-4">Aciertos por Horario (%)</h3>
                    <canvas id="chartHoras"></canvas>
                </div>

                <div class="p-4 bg-black/40 rounded-2xl border border-slate-800">
                    <h3 class="text-[10px] text-slate-500 font-bold uppercase mb-4">Frecuencia por Día</h3>
                    <canvas id="chartDias"></canvas>
                </div>
            </div>
        </section>

        <section id="page-train" class="page-content hidden">
            <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-2xl">
                <h2 class="text-lg font-bold mb-4 text-blue-400 uppercase"><i class="fas fa-brain mr-2"></i> Cerebro V4</h2>
                <div id="train-log" class="bg-black p-4 rounded-xl text-[10px] font-mono text-green-500 h-64 overflow-y-auto mb-6 border border-slate-800">
                    > Sistema listo...
                </div>
                <button onclick="iniciarEntrenamiento()" id="btn-train" class="w-full bg-slate-800 hover:bg-slate-700 p-4 rounded-2xl font-bold border border-slate-700 transition-all">
                    RE-ENTRENAR MODELO
                </button>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-md border-t border-slate-800 p-3 flex justify-around items-center z-50">
        <button onclick="showPage('home')" class="nav-btn text-blue-400 flex flex-col items-center">
            <i class="fas fa-dice text-xl"></i>
            <span class="text-[9px] mt-1 font-bold uppercase">Predicción</span>
        </button>
        <button onclick="showPage('historico')" class="nav-btn text-slate-500 flex flex-col items-center">
            <i class="fas fa-clock-rotate-left text-xl"></i>
            <span class="text-[9px] mt-1 font-bold uppercase">Historial</span>
        </button>
        <button onclick="showPage('stats')" class="nav-btn text-slate-500 flex flex-col items-center">
            <i class="fas fa-chart-line text-xl"></i>
            <span class="text-[9px] mt-1 font-bold uppercase">Análisis</span>
        </button>
        <button onclick="showPage('train')" class="nav-btn text-slate-500 flex flex-col items-center">
            <i class="fas fa-server text-xl"></i>
            <span class="text-[9px] mt-1 font-bold uppercase">Motor</span>
        </button>
    </nav>

    <script>
        // CONFIGURACIÓN DE PESTAÑAS
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-' + pageId).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('text-blue-400', 'text-slate-500'));
            event.currentTarget.classList.replace('text-slate-500', 'text-blue-400');
            
            if(pageId === 'historico') cargarHistorial();
            if(pageId === 'stats') cargarEstadisticas();
        }

        // LÓGICA DE GRÁFICOS (ESTILO NEÓN)
        let chart1, chart2;
        async function cargarEstadisticas() {
            try {
                const res = await fetch('/stats/precision');
                const data = await res.json();
                
                const ctx1 = document.getElementById('chartDias').getContext('2d');
                if(chart1) chart1.destroy();
                chart1 = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data.data),
                        datasets: [{
                            label: 'Volumen de Datos',
                            data: Object.values(data.data),
                            backgroundColor: '#3b82f6'
                        }]
                    },
                    options: { plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#1e293b' } } } }
                });

                const ctx2 = document.getElementById('chartHoras').getContext('2d');
                if(chart2) chart2.destroy();
                chart2 = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: ['9am', '11am', '1pm', '4pm', '7pm'],
                        datasets: [{
                            label: '% Precisión',
                            data: [75, 88, 62, 94, 50],
                            borderColor: '#10b981',
                            tension: 0.4,
                            fill: true,
                            backgroundColor: 'rgba(16, 185, 129, 0.1)'
                        }]
                    },
                    options: { plugins: { legend: { display: false } } }
                });
            } catch(e) { console.error("Error cargando stats"); }
        }

        // ... Mantén tus funciones de ejecutarPrediccion() y cargarHistorial() iguales ...
        // (Asegúrate de que cargarHistorial use la ruta /datos-historico que definiste en tu JS)
    </script>
</body>
</html>
